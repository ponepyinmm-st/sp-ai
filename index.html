<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Design Generator + Vertical Floor Plan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@400;500;600;700&family=Playfair+Display:wght@700&family=Lato:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans Myanmar', sans-serif; }
        .font-serif-display { font-family: 'Playfair Display', serif; }
        .font-eng { font-family: 'Lato', sans-serif; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const IconSparkles = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></svg>;
        const IconImage = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>;
        const IconMapPin = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const IconBuilding = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M8 10h.01"/><path d="M16 10h.01"/><path d="M8 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M16 18h.01"/></svg>;
        const IconScan = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/></svg>;
        const IconUpload = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconFileText = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const IconPhone = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>;
        const IconEdit = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;

        // --- Helper: Fetch with Retry (Updated to use internal API) ---
        async function fetchWithRetry(url, options, retries = 3, backoff = 2000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    const errorText = await response.text();
                    
                    if (response.status === 429 || response.status >= 500) {
                        if (retries > 0) {
                            await new Promise(r => setTimeout(r, backoff));
                            return fetchWithRetry(url, options, retries - 1, backoff * 2);
                        }
                    }
                    throw new Error(`Server Error: ${response.status} - ${errorText}`);
                }
                return response;
            } catch (err) {
                if (retries > 0) {
                    await new Promise(r => setTimeout(r, backoff));
                    return fetchWithRetry(url, options, retries - 1, backoff * 2);
                }
                throw err;
            }
        }

        // --- Helper: Robust JSON Cleaner ---
        const cleanJsonString = (str) => {
            if (!str) return '{}';
            try {
                const startIndex = str.indexOf('{');
                const endIndex = str.lastIndexOf('}');
                if (startIndex !== -1 && endIndex !== -1) {
                    return str.substring(startIndex, endIndex + 1);
                }
                return str;
            } catch (e) {
                return str;
            }
        };

        // --- Main App ---
        function App() {
            // Note: API Key is now handled securely on the server side (Vercel)
            const [adText, setAdText] = useState('ကမာရွတ်၊ လှည်းတန်းအနီး\n၁၂ ပေ ၅၀၊ ၆ လွှာ (ဓာတ်လှေကားပါ)\nဈေးနှုန်း - ၁၅၀၀ သိန်း\nကားပါကင်ရ၊ လုံခြုံရေးရှိ\n\nဆက်သွယ်ရန် - 09-12345678');
            
            // Text Screenshot Input
            const [textImageFile, setTextImageFile] = useState(null);
            const [textImagePreview, setTextImagePreview] = useState(null);

            const [imageFile, setImageFile] = useState(null);
            const [imagePreview, setImagePreview] = useState(null);
            
            const [logoFile, setLogoFile] = useState(null);
            const [logoPreview, setLogoPreview] = useState(null);
            
            // Chart Image State
            const [chartImageFile, setChartImageFile] = useState(null);
            const [chartImagePreview, setChartImagePreview] = useState(null);
            const [isAnalyzingChart, setIsAnalyzingChart] = useState(false);

            const [isGenerating, setIsGenerating] = useState(false);
            const [error, setError] = useState('');
            
            // Design Data State
            const [designData, setDesignData] = useState({
                title: "အဆင့်မြင့် ကွန်ဒို",
                subtitle: "ရောင်းရန်ရှိသည်",
                price: "၁၅၀၀ သိန်း",
                location: "ကမာရွတ်၊ ရန်ကုန်",
                features: ["ဓာတ်လှေကားပါ", "ကားပါကင်", "၂၄ နာရီ လုံခြုံရေး"],
                contact: "09-12345678"
            });

            // Floor Plan State
            const [floorConfig, setFloorConfig] = useState({ floors: 6, unitsPerFloor: 2 });
            const [floorUnits, setFloorUnits] = useState({});

            // Initialize/Regenerate Grid
            useEffect(() => {
                const newUnits = {};
                for (let f = 1; f <= floorConfig.floors; f++) {
                    for (let u = 1; u <= floorConfig.unitsPerFloor; u++) {
                        const id = `${f}-${u}`;
                        if (floorUnits[id]) {
                             newUnits[id] = floorUnits[id];
                        } else {
                             newUnits[id] = { id, floor: f, unit: u, status: 'available' };
                        }
                    }
                }
                setFloorUnits(newUnits);
            }, [floorConfig.floors, floorConfig.unitsPerFloor]);

            const updateDesignField = (field, value) => {
                setDesignData(prev => ({ ...prev, [field]: value }));
            };

            const updateFeatures = (text) => {
                const features = text.split('\n');
                setDesignData(prev => ({ ...prev, features: features }));
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setImageFile(file);
                    const reader = new FileReader();
                    reader.onloadend = () => setImagePreview(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleTextImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setTextImageFile(file);
                    const reader = new FileReader();
                    reader.onloadend = () => setTextImagePreview(reader.result);
                    reader.readAsDataURL(file);
                }
            };
            
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setLogoFile(file);
                    const reader = new FileReader();
                    reader.onloadend = () => setLogoPreview(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleChartImageUpload = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setChartImageFile(file);
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const base64Data = reader.result;
                        setChartImagePreview(base64Data);
                        await analyzeChartImage(base64Data);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const toggleUnitStatus = (id) => {
                setFloorUnits(prev => {
                    const current = prev[id];
                    const nextStatus = current.status === 'available' ? 'sold' : current.status === 'sold' ? 'reserved' : 'available';
                    return { ...prev, [id]: { ...current, status: nextStatus }};
                });
            };

            // 1. Analyze Text (AND Image) for Design
            const generateDesign = async () => {
                setIsGenerating(true);
                setError('');
                try {
                    const systemPrompt = `
                        You are a professional Burmese real estate copywriter creating a poster. 
                        The user will provide rough/draft text AND/OR an image containing text.
                        
                        **YOUR TASK:**
                        1.  Read the input.
                        2.  Rewrite content into **persuasive, professional Burmese**.
                        3.  **CRITICAL FOR TITLE:** The title MUST be **VERY SHORT (Max 3-5 words)**. It must fit in a header. 
                            - **Do NOT** use full sentences. 
                            - **USE** standard Myanmar Real Estate keywords (e.g., "ကမာရွတ် ကွန်ဒိုသစ်", "လှည်းတန်း ထောင့်တိုက်", "အဆင့်မြင့် တိုက်ခန်း").
                            - Focus on Location + Property Type or Main Benefit.
                        
                        **INSTRUCTIONS for fields:**
                        - **title:** Short, Punchy Burmese Title (Max 5 words).
                        - **subtitle:** A short tagline (e.g., "အသင့်နေထိုင်နိုင်သည်", "အရောင်း").
                        - **price:** Use Burmese numbers/currency (e.g., "၁၅၀၀ သိန်း").
                        - **location:** Short location string.
                        - **features:** List 3-4 key selling points (short phrases).
                        - **contact:** Phone numbers.
                        
                        Output ONLY valid JSON:
                        {
                            "title": "String (Burmese, Max 5 words)",
                            "subtitle": "String (Burmese)",
                            "price": "String (Burmese)",
                            "location": "String (Burmese)",
                            "features": ["String", "String"],
                            "contact": "String"
                        }
                    `;
                    
                    const contentParts = [];
                    if (adText) contentParts.push({ text: `Here is the rough draft text:\n${adText}` });
                    if (textImagePreview) {
                         const base64Content = textImagePreview.split(',')[1];
                         const mimeType = textImagePreview.substring(textImagePreview.indexOf(":") + 1, textImagePreview.indexOf(";"));
                         contentParts.push({ text: "Here is an image/screenshot containing ad details:" });
                         contentParts.push({ inlineData: { mimeType: mimeType, data: base64Content } });
                    }

                    if (contentParts.length === 0) throw new Error("စာသား (သို့) Screenshot ထည့်ပေးပါ။");

                    const payload = {
                        contents: [{ parts: contentParts }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    };

                    // UPDATED: Calling internal API endpoint
                    const response = await fetchWithRetry(
                        '/api/generate', 
                        {
                            method: 'POST', 
                            headers: { 'Content-Type': 'application/json' }, 
                            body: JSON.stringify(payload)
                        }
                    );

                    const data = await response.json();
                    
                    if (!data.candidates || !data.candidates[0].content) {
                         throw new Error("AI မှ အချက်အလက် မပြန်ပါ။ (Server Error or Invalid Response)");
                    }
                    const parsedData = JSON.parse(cleanJsonString(data.candidates[0].content.parts[0].text));
                    setDesignData({
                        title: parsedData.title || "အဆင့်မြင့် ကွန်ဒို",
                        subtitle: parsedData.subtitle || "ရောင်းရန်ရှိသည်",
                        price: parsedData.price || "ဈေးနှုန်း ညှိနှိုင်း",
                        location: parsedData.location || "ရန်ကုန်မြို့",
                        features: parsedData.features || [],
                        contact: parsedData.contact || ""
                    });
                } catch (err) { 
                    console.error(err); 
                    setError('စနစ်အလုပ်များနေပါသည် (သို့) အမှားရှိနေသည်။ ပြန်ကြိုးစားကြည့်ပါ။ (' + err.message + ')'); 
                } 
                finally { setIsGenerating(false); }
            };

            const analyzeChartImage = async (base64Image) => {
                setIsAnalyzingChart(true);
                setError('');
                try {
                    const base64Content = base64Image.split(',')[1];
                    const mimeType = base64Image.substring(base64Image.indexOf(":") + 1, base64Image.indexOf(";"));

                    const systemPrompt = `
                        Analyze this building floor plan chart image.
                        1. Determine the number of floors (rows) and units per floor (columns).
                        2. Identify the status of each unit:
                           - Red/Cross/Dark usually means "sold".
                           - Yellow/Orange usually means "reserved".
                           - Green/White/Open usually means "available".
                        3. **CRITICAL:** If there are PRICES or NUMBERS written inside the available boxes (e.g., "1500", "1200L", "1500 သိန်း"), extract them as the "price".
                        
                        Return ONLY a JSON object:
                        {
                            "floors": number,
                            "unitsPerFloor": number,
                            "units": [
                                { 
                                  "floor": number, 
                                  "unit": number, 
                                  "status": "available" | "sold" | "reserved",
                                  "price": "string" (optional, extracted text like '1500')
                                }
                            ]
                        }
                    `;

                    const payload = {
                        contents: [{ parts: [{ text: systemPrompt }, { inlineData: { mimeType: mimeType, data: base64Content } }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    };

                    // UPDATED: Calling internal API endpoint
                    const response = await fetchWithRetry(
                        '/api/generate', 
                        {
                            method: 'POST', 
                            headers: { 'Content-Type': 'application/json' }, 
                            body: JSON.stringify(payload)
                        }
                    );

                    const data = await response.json();
                    if (!data.candidates || !data.candidates[0].content) {
                         throw new Error("AI မှ ပုံကို မဖတ်နိုင်ပါ။");
                    }
                    const result = JSON.parse(cleanJsonString(data.candidates[0].content.parts[0].text));

                    if (result.floors && result.unitsPerFloor) {
                        setFloorConfig({ floors: result.floors, unitsPerFloor: result.unitsPerFloor });
                        const newUnits = {};
                        for (let f = 1; f <= result.floors; f++) {
                            for (let u = 1; u <= result.unitsPerFloor; u++) {
                                newUnits[`${f}-${u}`] = { id: `${f}-${u}`, floor: f, unit: u, status: 'available', price: '' };
                            }
                        }
                        if (result.units) {
                            result.units.forEach(u => {
                                const id = `${u.floor}-${u.unit}`;
                                if (newUnits[id]) {
                                    newUnits[id].status = u.status;
                                    if(u.price) newUnits[id].price = u.price; 
                                }
                            });
                        }
                        setFloorUnits(newUnits);
                    }
                } catch (err) { 
                    console.error(err); 
                    setError('ပုံရိပ်ဖတ်ရှုမရနိုင်ပါ (သို့) စနစ်အလုပ်များနေပါသည်: ' + err.message); 
                } 
                finally { setIsAnalyzingChart(false); }
            };

            const gridFloors = useMemo(() => {
                const floors = [];
                for(let f = floorConfig.floors; f >= 1; f--) floors.push(f);
                return floors;
            }, [floorConfig.floors]);

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans pb-20">
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-[#e30147] p-1.5 rounded text-white"><IconSparkles className="w-5 h-5" /></div>
                                <h1 className="text-xl font-bold text-gray-800">RealEstate<span className="text-[#e30147]">Gen</span></h1>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Control Panel */}
                        <div className="lg:col-span-4 space-y-6">
                            {/* Removed API Key Input Field - No longer needed on client side */}
                            
                            {/* 1. Text Data */}
                            <div className="bg-white p-6 rounded-lg border border-gray-200 shadow-lg">
                                <h2 className="text-lg font-bold mb-4 text-gray-800">1. ကြော်ငြာအချက်အလက်</h2>
                                <div className="space-y-4">
                                    <textarea value={adText} onChange={(e) => setAdText(e.target.value)} className="w-full h-24 bg-gray-50 border border-gray-300 rounded-lg p-3 text-sm focus:border-[#e30147] outline-none resize-none" placeholder="စာသားများ ရေးထည့်ပါ..." />
                                    <label className="flex items-center justify-center w-full h-10 border border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-[#e30147] bg-gray-50 overflow-hidden relative">
                                        {textImagePreview ? <div className="flex items-center gap-2 text-green-600 text-xs font-bold"><IconFileText className="w-4 h-4" /> Screenshot Loaded</div> : <div className="flex items-center gap-2 text-gray-400"><IconFileText className="w-4 h-4" /><span className="text-[10px] font-bold">Screenshot ပုံတင်ရန်</span></div>}
                                        <input type="file" className="hidden" accept="image/*" onChange={handleTextImageUpload} />
                                    </label>
                                    <hr className="border-gray-100" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <label className="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-[#e30147] bg-gray-50 overflow-hidden relative">
                                            {logoPreview ? <img src={logoPreview} className="w-full h-full object-contain p-2" /> : <div className="flex flex-col items-center text-gray-400"><div className="bg-gray-200 p-1.5 rounded-full mb-1"><IconUpload className="w-3 h-3" /></div><span className="text-[10px] font-bold">Logo</span></div>}
                                            <input type="file" className="hidden" accept="image/*" onChange={handleLogoUpload} />
                                        </label>
                                        <label className="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-[#e30147] bg-gray-50 overflow-hidden relative">
                                            {imagePreview ? <img src={imagePreview} className="w-full h-full object-cover opacity-80" /> : <div className="flex flex-col items-center text-gray-400"><IconImage className="w-5 h-5 mb-1" /><span className="text-[10px]">ပုံတင်ရန်</span></div>}
                                            <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                        </label>
                                    </div>
                                    <button onClick={generateDesign} disabled={isGenerating} className={`w-full py-2 rounded-lg font-bold shadow-md transition-all text-white text-xs uppercase tracking-wide ${isGenerating ? 'bg-gray-400 cursor-not-allowed' : 'bg-[#e30147] hover:bg-[#c0013c]'}`}>{isGenerating ? 'AI မှ ဖန်တီးနေပါသည်...' : 'ဒီဇိုင်းဖန်တီးမည်'}</button>
                                </div>
                                
                                {/* Manual Edit Section */}
                                <div className="mt-6 pt-4 border-t border-gray-100">
                                    <h3 className="text-xs font-bold text-gray-500 uppercase mb-3 flex items-center gap-1"><IconEdit className="w-3 h-3" /> အချက်အလက်များ ပြင်ဆင်ရန်</h3>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-[10px] text-gray-400 block mb-1">ခေါင်းစဉ်</label>
                                            <input 
                                                type="text" 
                                                value={designData.title}
                                                onChange={(e) => updateDesignField('title', e.target.value)}
                                                className="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-[10px] text-gray-400 block mb-1">ခေါင်းစဉ်ငယ်</label>
                                            <input 
                                                type="text" 
                                                value={designData.subtitle}
                                                onChange={(e) => updateDesignField('subtitle', e.target.value)}
                                                className="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none"
                                            />
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div>
                                                <label className="text-[10px] text-gray-400 block mb-1">ဈေးနှုန်း</label>
                                                <input 
                                                    type="text" 
                                                    value={designData.price}
                                                    onChange={(e) => updateDesignField('price', e.target.value)}
                                                    className="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-gray-400 block mb-1">ဖုန်း</label>
                                                <input 
                                                    type="text" 
                                                    value={designData.contact}
                                                    onChange={(e) => updateDesignField('contact', e.target.value)}
                                                    className="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-[10px] text-gray-400 block mb-1">တည်နေရာ</label>
                                            <input 
                                                type="text" 
                                                value={designData.location}
                                                onChange={(e) => updateDesignField('location', e.target.value)}
                                                className="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-[10px] text-gray-400 block mb-1">အချက်အလက်များ (တစ်ကြောင်းလျှင် တစ်ခု)</label>
                                            <textarea 
                                                value={designData.features.join('\n')}
                                                onChange={(e) => updateFeatures(e.target.value)}
                                                className="w-full h-20 border border-gray-200 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none resize-none"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 2. Floor Plan Editor */}
                            <div className="bg-white p-6 rounded-lg border border-gray-200 shadow-lg border-l-4 border-l-[#e30147]">
                                <h2 className="text-lg font-bold mb-4 text-gray-800 flex items-center gap-2">
                                    <IconBuilding className="w-5 h-5 text-[#e30147]" />
                                    2. အခန်းအနေအထား
                                </h2>
                                <div className="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <label className="flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-blue-300 rounded-lg cursor-pointer hover:bg-blue-100 transition-colors bg-white relative overflow-hidden group">
                                        {chartImagePreview ? <img src={chartImagePreview} className="w-full h-full object-contain" /> : <div className="flex flex-col items-center text-blue-400"><IconScan className="w-6 h-6 mb-1" /><span className="text-[10px] font-bold">ဇယားပုံတင်ရန်</span></div>}
                                        {isAnalyzingChart && <div className="absolute inset-0 bg-white/80 flex items-center justify-center"><div className="animate-spin rounded-full h-6 w-6 border-b-2 border-[#e30147]"></div></div>}
                                        <input type="file" className="hidden" accept="image/*" onChange={handleChartImageUpload} disabled={isAnalyzingChart} />
                                    </label>
                                </div>
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    <div><label className="text-[10px] font-bold text-gray-500 uppercase">အထပ်</label><input type="number" value={floorConfig.floors} onChange={(e) => setFloorConfig({...floorConfig, floors: parseInt(e.target.value) || 1})} className="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none" /></div>
                                    <div><label className="text-[10px] font-bold text-gray-500 uppercase">အခန်းအရေအတွက်</label><input type="number" value={floorConfig.unitsPerFloor} onChange={(e) => setFloorConfig({...floorConfig, unitsPerFloor: parseInt(e.target.value) || 1})} className="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-[#e30147] outline-none" /></div>
                                </div>
                                <div className="border border-gray-200 rounded p-2 bg-gray-50 max-h-48 overflow-y-auto">
                                    <div className="flex flex-col gap-1">
                                        {gridFloors.map(f => (
                                            <div key={f} className="flex gap-1 justify-center">
                                                {Array.from({length: floorConfig.unitsPerFloor}).map((_, i) => {
                                                    const u = i + 1;
                                                    const id = `${f}-${u}`;
                                                    const status = floorUnits[id]?.status || 'available';
                                                    let bgClass = 'bg-white border-gray-300';
                                                    if(status === 'sold') bgClass = 'bg-red-500 border-red-600';
                                                    if(status === 'reserved') bgClass = 'bg-yellow-400 border-yellow-500';
                                                    return (<button key={id} onClick={() => toggleUnitStatus(id)} className={`w-6 h-6 border rounded text-[8px] flex items-center justify-center ${bgClass}`} title={`Floor ${f} Unit ${u}`}></button>)
                                                })}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            {error && <div className="text-red-600 text-sm bg-red-50 p-3 rounded border border-red-200">{error}</div>}
                        </div>

                        {/* Preview Canvas */}
                        <div className="lg:col-span-8 flex flex-col items-center">
                            <h2 className="text-gray-500 text-sm font-bold uppercase tracking-wider mb-4">Live Preview (1080x1350)</h2>

                            {/* --- CANVAS (SPLIT LAYOUT) --- */}
                            <div className="relative w-full max-w-[500px] aspect-[1080/1350] bg-white shadow-2xl overflow-hidden flex flex-col text-gray-900">
                                
                                {/* 1. HEADER (12%) */}
                                <div className="h-[12%] bg-white px-6 flex items-center justify-between border-b-2 border-[#e30147]">
                                    <div className="h-14 w-14 flex-shrink-0 flex items-center justify-center">
                                        {logoPreview ? <img src={logoPreview} className="h-full w-full object-contain" /> : <div className="h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 text-[10px] font-bold border border-gray-300">LOGO</div>}
                                    </div>
                                    <div className="text-right overflow-hidden flex-1 pl-4">
                                        <p className="text-xs font-bold text-[#e30147] tracking-wider uppercase truncate">{designData.subtitle}</p>
                                        <h1 className="text-2xl font-bold text-gray-900 leading-tight whitespace-nowrap overflow-hidden text-ellipsis">
                                            {designData.title}
                                        </h1>
                                        <div className="flex items-center justify-end text-gray-600 text-xs mt-1 font-medium truncate">
                                            {designData.location}<IconMapPin className="w-3.5 h-3.5 ml-1 text-[#e30147] flex-shrink-0" />
                                        </div>
                                    </div>
                                </div>

                                {/* 2. BODY (SPLIT) (78%) */}
                                <div className="h-[78%] flex">
                                    {/* Left: Content (60%) */}
                                    <div className="w-[60%] flex flex-col h-full bg-white">
                                        {/* Image */}
                                        <div className="h-[55%] bg-gray-200 relative group overflow-hidden">
                                            {imagePreview ? <img src={imagePreview} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-gray-400 bg-gray-100"><span className="text-xs font-bold">Image Area</span></div>}
                                            <div className="absolute top-4 left-0 bg-[#e30147] text-white px-5 py-2 rounded-r-lg shadow-md">
                                                <span className="text-[10px] block opacity-90 mb-0.5">ဈေးနှုန်း</span>
                                                <span className="text-xl font-bold font-eng">{designData.price}</span>
                                            </div>
                                        </div>
                                        
                                        {/* Features List */}
                                        <div className="h-[45%] p-6 flex flex-col justify-center bg-white relative">
                                            <div className="absolute top-0 right-0 w-20 h-20 bg-gray-50 rounded-bl-full"></div>
                                            <h3 className="text-[#e30147] font-bold text-sm uppercase mb-4 border-l-4 border-[#e30147] pl-3">အထူးဝန်ဆောင်မှုများ</h3>
                                            <ul className="space-y-3">
                                                {designData.features && designData.features.slice(0,4).map((f,i) => (
                                                    <li key={i} className="flex items-center text-sm text-gray-700 font-medium">
                                                        <span className="w-2 h-2 bg-[#e30147] rounded-full mr-3"></span>
                                                        {f}
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>

                                    {/* Right: Vertical Floor Plan (40%) */}
                                    <div className="w-[40%] bg-gray-50 border-l border-gray-200 flex flex-col h-full">
                                        <div className="p-4 bg-white border-b border-gray-100 flex-shrink-0">
                                            <h3 className="text-[#e30147] font-bold text-sm uppercase text-center">အခန်းဇယား</h3>
                                            <div className="flex justify-center gap-3 mt-2 flex-wrap">
                                                <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 bg-white border border-gray-400 rounded-full"></div><span className="text-[10px] text-gray-600 font-bold">ရောင်းရန်</span></div>
                                                <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 bg-red-500 rounded-full"></div><span className="text-[10px] text-gray-600 font-bold">ရောင်းပြီး</span></div>
                                            </div>
                                        </div>
                                        
                                        {/* Auto-Adjust Grid Container */}
                                        <div className="flex-1 p-3 overflow-hidden flex flex-col justify-center">
                                            <div className="flex flex-col w-full h-full justify-between">
                                                {gridFloors.map((f) => (
                                                    <div key={f} className="flex items-center w-full flex-1 mb-1.5 last:mb-0 max-h-[14%] min-h-[30px]">
                                                        <div className="w-6 text-[10px] font-bold text-gray-500 mr-2 text-right flex-shrink-0">{f} လွှာ</div>
                                                        <div className="flex-1 flex gap-1.5 h-full">
                                                            {Array.from({length: floorConfig.unitsPerFloor}).map((_, i) => {
                                                                const u = i + 1;
                                                                const id = `${f}-${u}`;
                                                                const unitData = floorUnits[id];
                                                                const status = unitData?.status || 'available';
                                                                const price = unitData?.price || '';

                                                                let styles = "bg-white border-2 border-green-500 text-green-700";
                                                                let textContent = (
                                                                    <div className="flex flex-col items-center leading-none justify-center h-full">
                                                                        {price && <span className="text-[7px] mb-0.5 font-bold text-green-800 bg-green-100 px-1 rounded">{price}</span>}
                                                                        <span className="text-[9px]">ရောင်းရန်</span>
                                                                    </div>
                                                                );

                                                                if (status === 'sold') { 
                                                                    styles = "bg-red-500 border-2 border-red-500 text-white"; 
                                                                    textContent = <span className="text-[9px]">ရောင်းပြီး</span>; 
                                                                } 
                                                                else if (status === 'reserved') { 
                                                                    styles = "bg-yellow-400 border-2 border-yellow-400 text-white"; 
                                                                    textContent = <span className="text-[9px]">စာရင်းသွင်း</span>; 
                                                                }

                                                                return (
                                                                    <div key={id} className={`flex-1 rounded flex items-center justify-center font-bold shadow-sm h-full w-full ${styles}`}>
                                                                        {textContent}
                                                                    </div>
                                                                )
                                                            })}
                                                        </div>
                                                    </div>
                                                ))}
                                                <div className="ml-8 h-1 bg-gray-300 rounded-full mt-2 flex-shrink-0"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 3. FOOTER (10%) */}
                                <div className="h-[10%] bg-gray-900 text-white flex items-center justify-between px-8 relative overflow-hidden">
                                    <div className="absolute top-0 right-0 bottom-0 w-1/2 bg-[#e30147] transform skew-x-12 translate-x-10"></div>
                                    <div className="relative z-10 flex items-center gap-3">
                                        <div className="bg-white/10 p-2 rounded-full"><IconPhone className="w-5 h-5 text-[#e30147]" /></div>
                                        <div>
                                            <p className="text-[10px] text-gray-300 uppercase tracking-widest mb-0.5">ဆက်သွယ်ရန်</p>
                                            <p className="text-xl font-bold font-eng">{designData.contact}</p>
                                        </div>
                                    </div>
                                    <div className="relative z-10 text-right pr-4">
                                        <p className="text-xs font-bold uppercase tracking-widest">အမြန်ဆုံးဆက်သွယ်ပါ</p>
                                    </div>
                                </div>

                            </div>
                            <p className="mt-4 text-xs text-gray-400">Preview ပေါ်တွင် Right Click နှိပ်ပြီး "Save Image As" ဖြင့် သိမ်းဆည်းနိုင်ပါသည်။</p>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>